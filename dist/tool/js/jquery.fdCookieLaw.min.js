/*!
 *  FDC CookieLaw Tool - v1.0.0(0.11.2-beta)
 *  Cookie & Privacy management tool
 *  GitHub: https://github.com/FattiDiCookies/italianPrivacyPolicy/tree/master/dist/tool
 *  Docs: https://github.com/FattiDiCookies/italianPrivacyPolicy/wiki/FDC-Tool
 *  Bugs: https://github.com/FattiDiCookies/italianPrivacyPolicy/issues
 *
 *  (c) 2015 by FDC Crew
 *  Made by FDC Crew and released under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.jsonDocs=this.settings.docs,this.init()}var f="fdCookieLaw",g={config:"config.json",docs:"docs/docs.complete.json",page:"",banner:"",bannerPosition:"",acceptOnScroll:"",callbackOnAccepted:null,callbackOnRejected:null,debug:!0};a.extend(e.prototype,{init:function(){this.settings.debug===!0&&console.log(f+": start");var a=this;this.plugInit(a)},plugInit:function(a){this.getConfig(a)},getConfig:function(b){this.settings.debug===!0&&console.log(f+": getConfig() -> loading config"),a.ajax({url:b.settings.config,dataType:"json",success:function(a){var c=!1,d=!1,e=!1,f={};if(b.settings.banner===!0||a.cookieBanner.active===!0){f={cname:a.cookieBanner.cookieName,cvalue:a.cookieBanner.cookieValue,exdays:a.cookieBanner.cookieExpire};var g=b.cookieHunter(b,f);g===!1?(c=!0,e=!0):null!==b.settings.callbackOnAccepted&&b.settings.callbackOnAccepted()}""!==b.settings.page&&(c=!0,d=!0),c===!0&&b.getDocsData(b,a,d,e,f)},error:function(){b.settings.debug===!0&&console.log(f+": getConfig() -> ajax error loading config file"),a(b.element).html("<h1>Error!</h1>")}})},getDocsData:function(b,c,d,e,g){this.settings.debug===!0&&console.log(f+": getDocsData() -> loading documents"),a.ajax({url:b.jsonDocs,dataType:"json",success:function(a){if(e!==!1&&b.setBanner(b,c,a,g),d!==!1)switch(b.settings.page){case"privacy":b.getPrivacyPolicy(b,c,a);break;case"cookie":b.getCookiePolicy(b,c,a)}},error:function(){this.settings.debug===!0&&console.log(f+": getDocsData() -> ajax error loading docs")}})},setBanner:function(a,b,c,d){this.settings.debug===!0&&console.log(f+": setBanner() -> start banner"),""===a.settings.acceptOnScroll?d.acceptOnScroll=b.cookieBanner.acceptOnScroll:d.acceptOnScroll=a.settings.acceptOnScroll,a.settings.banner===!0&&(d.position=a.settings.bannerPosition,a.getCookieBanner(b,a,c,d)),""===a.settings.banner&&a.settings.banner!==!1&&b.cookieBanner.active===!0&&(d.position=b.cookieBanner.position,a.getCookieBanner(b,a,c,d))},getPrivacyPolicy:function(b,c,d){this.settings.debug===!0&&console.log(f+": getPrivacyPolicy() --> load page");var e=d.privacy_policy_docs["privacy-policy"],g="",h=c.privacyPolicy.personalData.length,i="",j=c.privacyPolicy.purposes.length,k="",l="",m="";if(a.each(c.privacyPolicy.personalData,function(a,b){m=a===h-1?".":";",k=0===a?"<ul>":"",l=a===h-1?"</ul>":"",g+=k+"<li>"+b+m+"</li>"+l}),a.each(c.privacyPolicy.purposes,function(a,b){m=a===j-1?".":";",k=0===a?"<ul>":"",l=a===j-1?"</ul>":"",i+=k+"<li>"+b+m+"</li>"+l}),e=e.replace(/\[\[NOME SITO\]\]/g,c.globals.site.name),e=e.replace(/\[\[URL SITO\]\]/g,c.globals.site.url),e=e.replace(/\[\[SOCIETA-RESPONSABILE\]\]/g,c.globals.company.name),e=e.replace(/\[\[INDIRIZZO\]\]/g,c.globals.company.address),""!==c.globals.company.vatNumber){var n=c.globals.company.vatLabel+" "+c.globals.company.vatNumber;e=e.replace(/\[\[PIVA\]\]/g,n)}e=e.replace(/\[\[NOME E COGNOME DEL RESPONSABILE\]\]/g,c.globals.administrator.name),e=e.replace(/\[\[EMAIL DI CONTATTO\]\]/g,c.globals.site.email),e=e.replace(/\[\[DATI PERSONALI\]\]/g,g),e=e.replace(/\[\[SCOPI RACCOLTA DATI\]\]/g,i),a(b.element).html(e)},getCookiePolicy:function(b,c,d){this.settings.debug===!0&&console.log(f+": getCookiePolicy()");var e=d.cookie_policy_docs["informativa-estesa"];e=e.replace(/\[\[NOME SITO\]\]/g,c.globals.site.name),e=e.replace(/\[\[URL SITO\]\]/g,c.globals.site.url),e=e.replace(/\[\[NOME E COGNOME DEL RESPONSABILE\]\]/g,c.globals.administrator.name),e=e.replace(/\[\[ELENCO SERVIZI\]\]/g,'<div id="cookiePolicyServices" class="fdctool__services"></div>'),e=e.replace(/\[\[PRIVACY-POLICY\]\]/g,'<a href="'+c.privacyPolicy.url+'" class="button privacy">LINK</a>'),a(b.element).html(e);var g="",h={cname:c.cookieBanner.cookieName,cvalue:c.cookieBanner.cookieValue,exdays:c.cookieBanner.cookieExpire},i=this.cookieHunter(b,h);g+='<div class="fdc-cookielaw__policy-buttons">    <button class="button on-policypage fdc-cookielaw__accept-button">Acconsento all\'uso dei cookie</button>    <button class="button button-red on-policypage fdc-cookielaw__reject-button">Rimuovo il consenso all\'uso dei cookie</button></div>',a(b.element).append(g),i===!1?(a(".fdc-cookielaw__reject-button.on-policypage").hide(),a(".fdc-cookielaw__accept-button.on-policypage").fadeIn()):(a(".fdc-cookielaw__accept-button.on-policypage").hide(),a(".fdc-cookielaw__reject-button.on-policypage").fadeIn()),b.cookieAcceptClick(b,h),b.cookieRejectClick(b,h),b.getServices(b,c,d)},getServices:function(b,c,d){a.each(c.cookiePolicy.services,function(b){if(this.active===!0){var e=c.cookiePolicy.services[b].catLabel,f=c.cookiePolicy.services[b].catName,g="servicesTool-"+f;a("#cookiePolicyServices").append('<div id="'+g+'" class="fdctool__services_cat"></div>'),a("#"+g).append('<h2 class="fdctool__services_cat-title">'+e+"</h2>"),a.each(c.cookiePolicy.services[b].services,function(b,e){if(e===!0){var f=d.cookie_policy_docs[b];"undefined"!=typeof f&&(f=f.replace(/\[\[NOME SITO\]\]/g,c.globals.site.name),f=f.replace(/\[\[URL SITO\]\]/g,c.globals.site.url),a("#"+g).append(f))}})}})},getCookieBanner:function(c,d,e,g){this.settings.debug===!0&&console.log(f+": getCookieBanner() -> load banner");var h=d.cookieHunter(d,g);if(h===!1){g.text=d.getBannerText(d,c,e,g),g.textLink='<a href="'+c.cookiePolicy.url+'" title="Informativa Estesa">informativa estesa</a>',g.text=g.text.replace(/\[\[INFORMATIVA-ESTESA\]\]/g,g.textLink),g.text=g.text.replace(/\[\[NOME SITO\]\]/g,c.globals.site.name);var i="";i+='<div id="fdCookieLawBanner" class="fdc-cookielaw__banner '+g.position+'Banner">',i+='   <div class="fdc-cookielaw__banner-text">',i+=g.text,i+="   </div>",i+='   <div class="fdc-cookielaw__banner-buttons">',i+='       <a href="'+c.cookiePolicy.url+'" class="button privacy">Informativa Estesa</a>',i+='       <a href="#" id="cookieAccept" class="button accept fdc-cookielaw__accept-button" href="'+c.cookiePolicy.url+'" class="button privacy">OK</a>',i+="   </div>",i+="</div>",a("body").append(i),a("body").promise().done(function(){setTimeout(function(){a("#fdCookieLawBanner").addClass("showBanner")},100)}),d.cookieAcceptClick(d,g),g.acceptOnScroll===!0&&a(b).one("scroll",function(){a("#fdCookieLawBanner").removeClass("showBanner"),d.writeCookie(g.cname,g.cvalue,g.exdays)})}},cookieAcceptClick:function(b,c){a(".fdc-cookielaw__accept-button").on("click",function(d){d.preventDefault(),a("#fdCookieLawBanner").removeClass("showBanner"),a(".fdc-cookielaw__accept-button.on-policypage").hide(),a(".fdc-cookielaw__reject-button.on-policypage").fadeIn(),b.writeCookie(c.cname,c.cvalue,c.exdays),null!==b.settings.callbackOnAccepted&&b.settings.callbackOnAccepted()})},cookieRejectClick:function(b,c){a(".fdc-cookielaw__reject-button").on("click",function(d){d.preventDefault(),a("#fdCookieLawBanner").addClass("showBanner"),a(".fdc-cookielaw__reject-button.on-policypage").hide(),a(".fdc-cookielaw__accept-button.on-policypage").fadeIn(),b.writeCookie(c.cname,"rejected",c.exdays),null!==b.settings.callbackOnRejected&&b.settings.callbackOnRejected()})},getBannerText:function(a,b,c,d){var e="";return b.cookieBanner.text.customText===!1||""===b.cookieBanner.text.customText?(a.settings.debug===!0&&console.log(f+": getBannerText() -> load text"),b.cookieBanner.text.techCookies===!0&&b.cookieBanner.text.profCookies===!1&&(e=c.cookie_policy_docs.banner_tech),b.cookieBanner.text.techCookies===!0&&b.cookieBanner.text.profCookies===!0&&(e=c.cookie_policy_docs["banner_tech-prof"]),b.cookieBanner.text.techCookies===!1&&b.cookieBanner.text.profCookies===!0&&(e=c.cookie_policy_docs.banner_prof)):(a.settings.debug===!0&&console.log(f+": getBannerText() -> load custom text"),e=b.cookieBanner.text.customText),e},cookieHunter:function(a,b){var c=a.readCookie(b.cname),e=c!==d&&c!==b.cvalue?!1:!0;return e},writeCookie:function(a,b,d){this.settings.debug===!0&&console.log(f+": writeCookie("+a+" "+b+" "+d+")");var e=new Date;e.setTime(e.getTime()+24*d*60*60*1e3);var g="expires="+e.toUTCString();c.cookie=a+"="+b+"; "+g+"; path=/ "},readCookie:function(a){this.settings.debug===!0&&console.log(f+": readCookie("+a+")");for(var b=a+"=",d=c.cookie.split(";"),e=0;e<d.length;e++){for(var g=d[e];" "==g.charAt(0);)g=g.substring(1);if(0===g.indexOf(b))return g.substring(b.length,g.length)}return""}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);